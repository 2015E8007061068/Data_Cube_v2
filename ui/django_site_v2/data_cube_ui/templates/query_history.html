<!-- Author: AHDS
     Creation date: 2016-06-23
     Modified by:
     Last modified date: -->
<!-- Requires other implementation of array queries, csrf token, query_event_listener.  -->
<div id="query_history_container">
  {% for query in query_history %}
    <h3 id='past_{{ forloop.counter0 }}'>{{ query.title }}  : Submitted {{ query.query_start|date:"m/d/Y fa" }}</h3>
    <div class="spaced_details">
      <table id='query_history{{ forloop.counter0 }}'>
        <tr>
          <td class="title">Latitude Range: </td>
          <td class="right_aligned_text">({{ query.latitude_min }}, {{ query.latitude_max }})</td>
        </tr>
        <tr>
          <td class="title">Longitude Range: </td>
          <td class="right_aligned_text">({{ query.longitude_min }}, {{ query.longitude_max }})</td>
        </tr>
        <tr>
          <td class="title">Time Range: </td>
          <td class="right_aligned_text">({{ query.time_start|date:"m/d/Y" }}, {{ query.time_end|date:"m/d/Y" }})</td>
        </tr>
        <tr>
          <td class="title">Bands:</td>
          <td class="right_aligned_text">{{ query.measurements }}</td>
        </tr>
        <tr>
          <td class="title">Description:</td>
          <td class="right_aligned_text">{{ query.description }}</td>
        </tr>
      </table>
      <button id="load{{forloop.counter0}}" class="centered" type="button" onclick="add_result_from_history('{{ query.query_id }}', '{{ query.title }}');">Load this result</button>
    </div>
  {% endfor %}
</div>
<script>

  $( "#query_history_container" ).accordion({
      active: false,
      collapsible: true,
      heightStyle: "content"
    });

  function add_result_from_history(query_id, query_type) {
    if (typeof(Worker) !== undefined) {
        var w = new Worker("/static/assets/js/dcw.js");
        w.postMessage({
            'msg' : "HISTORY",
            'result_type': query_type,
            'query_id': query_id,
            'csrf': csrftoken
        });
        w.addEventListener("message", query_event_listener);
    } else {
        alert("This browser does not support webworkers.");
    }
  }
</script>
